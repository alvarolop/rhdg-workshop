<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security :: RH Data Grid Workshop</title>
    <link rel="canonical" href="https://alvarolop.github.io/rhdg-workshop/33-server-configuration-security.html">
    <link rel="prev" href="32-server-configuration-resources.html">
    <link rel="next" href="40-cache-configuration-cache-crd.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://alvarolop.github.io/rhdg-workshop">RH Data Grid Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-introduction.html">1. Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="20-setup.html">2. Environment Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3. Server Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="31-server-configuration-basic.html">3.1. Initial Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="32-server-configuration-resources.html">3.2. Resourcing and labels</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="33-server-configuration-security.html">3.3. Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">4. Cache Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="40-cache-configuration-cache-crd.html">4.1. Cache CRD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="41-cache-configuration-encoding.html">4.2. Encoding</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="42-cache-configuration-expiration.html">4.3. Expiration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="43-cache-configuration-memory.html">4.4. Memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="44-cache-configuration-templates.html">4.5. Cache Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">5. Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="50-troubleshooting-basic.html">5.1. Basic Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="51-troubleshooting-rest-api.html">5.2. REST to retrieve information</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="52-troubleshooting-jvm-debugging.html">5.3. JVM debugging</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="60-exercises.html">6. Exercises</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="61-exercises-level-1.html">6.1. Level I</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="62-exercises-level-2.html">6.2. Level II</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="63-exercises-level-3.html">6.3. Level III</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="70-conclusions.html">7. Conclusions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">RHDG Workshop</a></li>
    <li>3. Server Configuration</li>
    <li><a href="33-server-configuration-security.html">3.3. Security</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://github.com/alvarolop" target="_blank" rel="noopener noreferrer"> © 2023 - Álvaro López Medina</a></div>
</div>  <div class="content">
<article class="doc">
<h1 class="page">Security</h1>
<div class="sect1">
<h2 id="_security_i_authentication"><a class="anchor" href="#_security_i_authentication"></a>Security I: Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the essentials in place, it&#8217;s time to tighten security. As you learn to authenticate using the operator and OCP secret, keep in mind that this layer of protection is the springboard for the security enhancements to come.</p>
</div>
<div class="paragraph">
<p>The Red Hat Data Grid operator enables authentication by default. This configuration enforces that
application users need credentials to access Data Grid clusters. Authentication in Data Grid is based on
Security Realms. You can configure the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP Realm</strong>: LDAP realms connect to LDAP servers, such as OpenLDAP, Red Hat Directory Server,
Apache Directory Server, or Microsoft Active Directory, to authenticate users and obtain membership
information.</p>
</li>
<li>
<p><strong>Properties Realm</strong>: Property realms use property files to define users and groups.</p>
</li>
<li>
<p><strong>Token Realm</strong>: Token realms use external services to validate tokens and require providers that are
compatible with RFC-7662 (OAuth2 Token Introspection), such as Red Hat SSO.</p>
</li>
<li>
<p><strong>Truststore Realm</strong>: Trust store realms use certificates, or certificate chains, that verify Data Grid
Server and client identities when they negotiate connections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure that we learn gradually all the aspects of the server configuration, we are going to start with the <strong>Properties Realm</strong>. Configuring Properties Realm authentication using the operator consists of two steps.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Level up!</div>
If you are interested in other Realms you can investigate further during the second day of the workshop. Especially, you will find some tips for the LDAP Realm in the Advanced Exercises Section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Step 1: Create a secret with the credentials</strong></p>
</div>
<div class="paragraph">
<p>First, create a Secret that contains all the users and their passwords:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: cluster-credentials
type: Opaque
stringData:
  identities.yaml: |-
    credentials:
    - username: developer
      password: developer
    - username: admin
      password: password
    - username: $YOUR_USERNAME
      password: openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, there will be three users. Remember to change <code>$YOUR_USERNAME</code> with the real value.</p>
</div>
<div class="paragraph">
<p><strong>Step 2: Enable authentication and add the secret to the CR</strong></p>
</div>
<div class="paragraph">
<p>In the configuration of the <code>Infinispan</code> CR, set up authentication and link it to the previous secret:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  security:
    endpointAuthentication: true
    endpointSecretName: cluster-credentials</code></pre>
</div>
</div>
<div class="paragraph">
<p>Try to access the web console again, you will see a prompt requesting you to introduce <code>username</code> and <code>password</code>. You can use any from the previous secret, as we have not enabled authorization yet.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_ii_authorization_with_rbac"><a class="anchor" href="#_security_ii_authorization_with_rbac"></a>Security II: Authorization with RBAC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorization is a security feature that requires users to have certain permissions before they can access
caches or interact with Data Grid resources. You assign roles to users that provide different levels of
permissions, from read-only access to full, superuser privileges.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Level up!</div>
Do you want to make sure that users belong to a role with sufficient permissions before they can perform operations on a specific Cache? You can explore that configuration in the Advanced Exercises Section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s make sure that the admin user has ADMIN rights to the Data Grid cluster, but the user1 has monitor and read-only capabilities. Configuring authorization using the operator consists of two steps.</p>
</div>
<div class="paragraph">
<p><strong>Step 1: Modify the credentials secret with the roles</strong></p>
</div>
<div class="paragraph">
<p>Data Grid includes several roles that provide users with permissions to access caches and Data Grid resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>admin</strong>: Superuser with all permissions including control of the Cache Manager lifecycle.</p>
</li>
<li>
<p><strong>deployer</strong>: Can create and delete Data Grid resources in addition to application permissions.</p>
</li>
<li>
<p><strong>application</strong>: Has read and write access to Data Grid resources in addition to observer permissions. Can also listen to events and execute server tasks and scripts.</p>
</li>
<li>
<p><strong>observer</strong>: Has read access to Data Grid resources in addition to monitor permissions.</p>
</li>
<li>
<p><strong>monitor</strong>: Can view statistics via JMX and the metrics endpoint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to test all the possibilities, you can define the following roles. Scroll down to see what to expect from each user:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: cluster-credentials
type: Opaque
stringData:
  identities.yaml: |-
    credentials:
    - username: developer
      password: developer
    - username: admin
      password: password
      roles:
        - admin
    - username: $YOUR_USERNAME
      password: openshift
      roles:
        - application</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 2: Enable authorization in the Infinispan CR</strong></p>
</div>
<div class="paragraph">
<p>We will enable authorization at the cluster level just with the property <code>spec.security.authorization.enabled = true</code>:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  security:
    endpointAuthentication: true
    endpointSecretName: cluster-credentials
    authorization:
      enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you log in to the web console, you will quickly see the differences between each user: The <code>admin</code> has a button to create caches; <code>user1</code> does not, but can check the server statistics; <code>developer</code> cannot retrieve the statistics as he does not belong to a role with the MONITOR permission.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/32-server-rhdg-console-admin.png" alt="32 server rhdg console admin">
</div>
<div class="title">Figure 1. Web console for the user admin</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/32-server-rhdg-console-user1.png" alt="32 server rhdg console user1">
</div>
<div class="title">Figure 2. Web console for the user user1</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/32-server-rhdg-console-developer.png" alt="32 server rhdg console developer">
</div>
<div class="title">Figure 3. Web console for the user developer</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_iii_encryption"><a class="anchor" href="#_security_iii_encryption"></a>Security III: Encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Encryption allows encrypting connections between clients and Data Grid pods with Red Hat OpenShift service certificates or custom TLS certificates. Whether you opt for one or the other, remember that encryption is a great tool for safeguarding your cache infrastructure and keeping your cache information safe during transit.</p>
</div>
<div class="paragraph">
<p>With the service certificates, the Data Grid Operator automatically generates TLS certificates that are signed by the Red Hat OpenShift service CA. Data Grid Operator then stores the certificates and keys in a k8s Secret so you can retrieve them and use them with remote clients.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Level up!</div>
Do you want to explore the usage of custom certificates? You can explore that configuration in the Advanced Exercises Section.
</td>
</tr>
</table>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  security:
    endpointEncryption:
      type: Service</code></pre>
</div>
</div>
<div class="paragraph">
<p>After setting this configuration and waiting for a few seconds, all the pods will automatically restart and will just accept HTTPS connections. Therefore, change the protocol in the URL or just execute the following command to get the URL:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Modify the command according to your user.
oc get routes --template='https://{{(index .items 0).spec.host }}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After accepting that <code>Your connection is not private</code> because the certificate is auto-signed using the OCP CA, you will be able to access Data Grid pods using HTTPS instead of HTTP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrap_up"><a class="anchor" href="#_wrap_up"></a>Wrap Up!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With each section, you gained a deeper understanding of key Red Hat Data Grid concepts, empowering you to optimize cache management and elevate your infrastructure expertise. Let&#8217;s continue our journey of exploration and learning!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="32-server-configuration-resources.html">3.2. Resourcing and labels</a></span>
  <span class="next"><a href="40-cache-configuration-cache-crd.html">4.1. Cache CRD</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
