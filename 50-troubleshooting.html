<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Troubleshooting :: RH Data Grid Workshop</title>
    <link rel="canonical" href="https://alvarolop.github.io/rhdg-workshop/50-troubleshooting.html">
    <link rel="prev" href="40-cache-configuration.html">
    <link rel="next" href="60-exercises.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://alvarolop.github.io/rhdg-workshop">RH Data Grid Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-introduction.html">1. Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="20-setup.html">2. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-setup.html#access-console">Access - OCP Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-setup.html#access-cli">Access - OC Client</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3. Server Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="31-server-configuration-basic.html">3.1. Basic Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="32-server-configuration-security.html">3.2. Security</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="40-cache-configuration.html">4. Cache Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="50-troubleshooting.html">5. Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="60-exercises.html">6. Exercises</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="70-conclusions.html">7. Conclusions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">RHDG Workshop</a></li>
    <li><a href="50-troubleshooting.html">5. Troubleshooting</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://github.com/alvarolop" target="_blank" rel="noopener noreferrer"> © 2023 - Álvaro López Medina</a></div>
</div>  <div class="content">
<article class="doc">
<h1 class="page">Troubleshooting</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As we move forward to our final phase, we enter the Troubleshooting Section. Here, we provide you with essential tools and techniques to tackle any issues that come your way. As an administrator of the infrastructure, you&#8217;ll master the art of collecting cluster information for effective debugging. Join us in this enlightening section to strengthen your troubleshooting skills and enhance your cache optimization abilities.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by collecting important details about the Openshift setup, including CRDs, and pod logs and events. Then, we&#8217;ll dig into examining the Data Grid server, getting the caches' configuration and a complete server report. Lastly, we&#8217;ll focus on JVM debugging, getting info from the Java Heap Dump and Java Thread Dump.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collecting_openshift_resources"><a class="anchor" href="#_collecting_openshift_resources"></a>Collecting Openshift resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ok, we don&#8217;t know yet what is going on. This section will help us to identify all the components of our installation and give us a methodic way of examining issues.</p>
</div>
<div class="sect2">
<h3 id="_retrieving_the_list_of_server_pods"><a class="anchor" href="#_retrieving_the_list_of_server_pods"></a>Retrieving the list of server pods</h3>
<div class="paragraph">
<p>This might seem trivial, but we need to list the pods to then execute other commands inside the pods. Execute the following command to retrieve the full list of pods:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get the full list of pods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -l user=$YOUR_USER</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="title">Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME        READY   STATUS    RESTARTS   AGE
cluster-0   1/1     Running   0          19m
cluster-1   1/1     Running   0          19m</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrieving_all_the_logs_for_investigation"><a class="anchor" href="#_retrieving_all_the_logs_for_investigation"></a>Retrieving all the logs for investigation</h3>
<div class="paragraph">
<p>Here you have to take into account that three main components take part in the configuration and you should know their responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>infinispan-operator-controller-manager</code>: This is the operator itself and runs in this workshop in a different namespace named <code>rhdg-operator</code>. It synchronizes the configuration of the CRDs with Openshift objects and the Infinispan server itself. There is an exception for the Cache CRD when the <code>.spec.configListener.enabled</code> = true in the Infinispan CRD - which is enabled by default-, this sync is delegated to the config-listener deployed for each cluster.</p>
<div class="listingblock console-input">
<div class="title">Check the logs of the operator pod</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc logs -f $(oc get pods -n rhdg-operator --template="{{(index .items 0).metadata.name }}") -n rhdg-operator</code></pre>
</div>
</div>
</li>
<li>
<p><code>cluster-config-listener</code>: There is one per cluster and it can be disabled when <code>.spec.configListener.enabled</code> = false in the Infinispan CRD. It is responsible for the bidirectional reconciliation of cache configurations between the Data Grid server and the Cache CRD.</p>
<div class="listingblock console-input">
<div class="title">Check the logs of the config-listener pod</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc logs -f $(oc get pods -l app=infinispan-config-listener-pod --template="{{(index .items 0).metadata.name }}")</code></pre>
</div>
</div>
</li>
<li>
<p><code>cluster-pods</code>: These are the actual pods of the cluster. In its logs, you can see issues related to server configuration, the clustering based on JGroups, and access logs.</p>
<div class="listingblock console-input">
<div class="title">Check the logs of the server pods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc logs -f cluster-0</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_retrieving_the_openshift_configuration"><a class="anchor" href="#_retrieving_the_openshift_configuration"></a>Retrieving the Openshift configuration</h3>
<div class="paragraph">
<p>This information is essential for the Data Grid support team to have a clear idea of the issue that you are facing. The recommended way to collect information is using the inspect command:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get the full report of the namespace</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc adm inspect namespace/$YOUR_USER-rhdg</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have enough permissions to execute the above command, you will need that information manually.</p>
</div>
<div class="paragraph">
<p>The <code>oc adm inspect</code> command does not collect Custom resources. Therefore, you will need to collect the separately:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get the custom resources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get infinispan -o yaml &gt; infinispan.yaml

oc get cache -o yaml &gt; caches.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_data_grid_server_report"><a class="anchor" href="#_the_data_grid_server_report"></a>The Data Grid server report</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data Grid Server provides aggregated reports in tar.gz archives that contain diagnostic information about server instances and host systems. The report provides details about CPU, memory, open files, network sockets and routing, and threads, in addition to configuration and log files.</p>
</div>
<div class="paragraph">
<p>Retrieving the server report takes several steps, as you have to use the Infinispan CLI. In the following command, I have automated the process so that you can generate it and download it easily:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get the server report</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Generate the report
oc exec cluster-0 -- bash -c 'echo "server report" | ./bin/cli.sh --trustall -c https://admin:password@$HOSTNAME:11222 -f -'
# Download the report
oc exec cluster-0 -- bash -c 'files=( *tar.gz* ); cat "${files[0]}"' &gt; $(date +"%Y-%m-%d-%H-%M")-cluster-0-report.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>The report comprises the execution of several useful commands that will help you understand the reasons why the server might be misconfigured:</p>
</div>
<div class="listingblock console-output">
<div class="title">Server report output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ls -1 cluster-0-report
    184
    conf
    cpuinfo
    data
    df
    ip-address
    ip-maddress
    ip-mroute
    ip-route
    log
    lsof
    meminfo
    os-release
    ss-tcp
    ss-udp
    uname</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_rest_api_to_retrieve_information_from_the_cluster"><a class="anchor" href="#_using_the_rest_api_to_retrieve_information_from_the_cluster"></a>Using the REST API to retrieve information from the cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section compiles a set of REST endpoints useful to retrieve configuration from the server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some of the objects of this section might be new to you: Proto files, server tasks, indexes, etc. Do not worry, these commands will be useful for you for the Advanced Exercises Section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following REST requests have been done using the <code>curl</code> command, adapt it to any method you consider more convenient.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to define the env var with the REST Endpoint before executing the next commands:</p>
</div>
<div class="listingblock console-input">
<div class="title">Set Data Grid server URL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">RHDG_URL=$(oc get routes --template='https://{{(index .items 0).spec.host }}')</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_problems_with_server_config"><a class="anchor" href="#_problems_with_server_config"></a>Problems with Server Config?</h3>
<div class="paragraph">
<p>You can retrieve the actual configuration of the Red Hat Data Grid server. As you know, the final configuration is the result of a merge operation between several configuration files. You can see all of them checking the command executed in the JVM (First line of the pod logs).</p>
</div>
<div class="paragraph">
<p>If you want to show the resulting configuration, execute the following command:</p>
</div>
<div class="listingblock console-input">
<div class="title">Curl command to retrieve Server Config</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/server/config | yq -P .</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_problems_with_protobuf"><a class="anchor" href="#_problems_with_protobuf"></a>Problems with Protobuf?</h3>
<div class="paragraph">
<p>You can list all the <code>.proto</code> files and also all the Proto types using the REST API.</p>
</div>
<div class="listingblock console-input">
<div class="title">Curl command to retrieve the Proto files</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/schemas | jq .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="title">Curl command to retrieve the Proto Types (Primitives)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/schemas?action=types | jq .</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_problems_with_cache_definitions"><a class="anchor" href="#_problems_with_cache_definitions"></a>Problems with cache definitions?</h3>
<div class="paragraph">
<p>At some point, you will want to know if a certain cache name is configured in the cluster, or if the cache definition was correctly applied. You can check the status and configuration of the caches with the following commands:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get all caches</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/caches | jq .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="title">Check the status of the cluster and all the caches</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/cache-managers/default/health | jq .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="title">Check cache config and stats</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01 | yq -P .</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_problems_with_server_tasks"><a class="anchor" href="#_problems_with_server_tasks"></a>Problems with Server tasks?</h3>
<div class="paragraph">
<p>You can also define Server Tasks in Java and load them on the server. Then, you will be able to execute them using REST or Hot Rod. You can list the Server tasks with the following REST call:</p>
</div>
<div class="listingblock console-input">
<div class="title">List all the available Server Tasks</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/tasks | jq .</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_problems_with_the_content_of_a_cache"><a class="anchor" href="#_problems_with_the_content_of_a_cache"></a>Problems with the content of a cache?</h3>
<div class="paragraph">
<p>You can also fully interact with the cache, creating, modifying, listing and removing contents of every cache compatible with the REST interface (For example, you cannot create Java Serialized objects). Here we list some commands to get the status and debug issues. Go to the Exercises section for more tasks about the REST endpoint.</p>
</div>
<div class="listingblock console-input">
<div class="title">List all the entries of the cache</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01?action=entries | jq .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="title">Clear a cache</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -X POST -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01?action=clear</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_problems_with_indexes_and_queries"><a class="anchor" href="#_problems_with_indexes_and_queries"></a>Problems with indexes and queries?</h3>
<div class="paragraph">
<p>Queries and indexes also provide some specific endpoints for debugging and reconfiguration. First, queries are executed over indexed caches. When you delete fields or change index field definitions, you must rebuild the index to ensure the index is consistent with the data in the cache. You can do that using the following endpoint:</p>
</div>
<div class="listingblock console-input">
<div class="title">Reindex a cache.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -X POST -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01/search/indexes?action=reindex</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you begin to execute queries over the cache, you will be interested in debugging based on statistics. Obtain information about queries and indexes in caches with GET requests:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get cache index and query statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01/search/stats | jq .</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adjusting_log_levels"><a class="anchor" href="#_adjusting_log_levels"></a>Adjusting log levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Change levels for different Data Grid logging categories when you need to debug issues. You can also adjust log levels to reduce the number of messages for certain categories to minimize the use of container resources. You can try to change the logging configuration without restarting by adding the following lines in the Infinispan CR:</p>
</div>
<div class="listingblock console-input">
<div class="title">Add custom log levels</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  logging:
    categories:
      org.infinispan.REST_ACCESS_LOG: trace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you can execute the following query and you will see that access logs per REST call are only logged to stdout if <code>REST_ACCESS_LOG</code> = <code>trace</code>:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get cache index and query statistics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -s -k -u admin:password $RHDG_URL/rest/v2/caches/cache-replicated-01?action=entries</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jvm_debugging"><a class="anchor" href="#_jvm_debugging"></a>JVM debugging</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_thread_dump"><a class="anchor" href="#_java_thread_dump"></a>Java Thread Dump</h3>
<div class="paragraph">
<p>A <strong>Java thread dump</strong> is a snapshot of what every thread in the JVM is doing at a particular point in time. Each thread in the JVM is listed with its name and ID, its current state and the Java call stack showing what monitor it has locked or is waiting on.</p>
</div>
<div class="listingblock console-input">
<div class="title">Get a Thread Dump</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -s -k -u admin:password $RHDG_URL/rest/v2/server/threads</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_heap_dump"><a class="anchor" href="#_java_heap_dump"></a>Java Heap Dump</h3>
<div class="paragraph">
<p>A <strong>Java Heap Dump</strong> is a snapshot of all the objects that are in memory in the JVM at a certain moment. They are very useful for troubleshooting memory leak problems and optimizing memory usage in Java applications. Heap dumps are usually stored in binary format <code>hprof</code> files.</p>
</div>
<div class="listingblock console-input">
<div class="title">Get a Heap Dump</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Change "cache-replicated-01" to your desired cache name
curl -X POST -s -k -u admin:password $RHDG_URL/rest/v2/server/memory?action=heap-dump
# Take the filename from the output to copy it to your machine
oc cp cluster-0:/opt/infinispan/server/data/$DUMP_FILENAME.prof . heapdump-cluster-0.hprof</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logging_gc_messages"><a class="anchor" href="#_logging_gc_messages"></a>Logging GC messages</h3>
<div class="paragraph">
<p>The Data Grid Operator does not log Garbage Collector (GC) messages by default. You can direct GC messages to stdout with the following JVM options:</p>
</div>
<div class="listingblock console-input">
<div class="title">Configure GC messages to stdout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  container:
    # If you want to keep the timezone config, just append the following to the existing config
    extraJvmOpts: "-Xlog:gc*:stdout:time,level,tags"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If instead, you want the logs in a separate file (as it might be quite verbose), you can use a configuration like the following:</p>
</div>
<div class="listingblock console-input">
<div class="title">Configure GC messages to file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: infinispan.org/v1
kind: Infinispan
metadata:
  name: cluster
spec:
  container:
    # If you want to keep the timezone config, just append the following to the existing config
    extraJvmOpts: "-Xlog:gc*=info:file=/tmp/gc.log:time,level,tags,uptimemillis:filecount=10,filesize=1m"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_analyzing_file_descriptions"><a class="anchor" href="#_analyzing_file_descriptions"></a>Analyzing File descriptions</h3>
<div class="paragraph">
<p>A file descriptor is a number that uniquely identifies an open file in a computer&#8217;s operating system. It describes a data resource, and how that resource may be accessed. It is needed to open <strong>files</strong>, <strong>network sockets</strong>, etc. There is a <strong>default limit</strong> to the number of opened file descriptors. If you suspect that you are matching that limit, you can check with the following command:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get the opened file descriptors</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec cluster-0 -- lsof -P &gt; lsof-cluster-0.txt</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_converting_cache_definitions_using_the_rest_api"><a class="anchor" href="#_converting_cache_definitions_using_the_rest_api"></a>Converting Cache definitions using the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Do you like a specific format to define caches (YAML, XML, JSON), but you found a tutorial with a cache definitionin a different format and would like to convert it? That&#8217;s easy! There are two use cases here.</p>
</div>
<div class="paragraph">
<p>If the cache is already in a cluster, you can retrieve it in any of the three formats just sending the proper header. Let&#8217;s use the same cache as in previous exercises:</p>
</div>
<div class="listingblock console-input">
<div class="title">Get Cache Definition in different formats</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Accept YAML
curl -s -k -u admin:password -H "Accept: application/yaml" $RHDG_URL/rest/v2/caches/cache-replicated-01?action=config
# Accept XML
curl -s -k -u admin:password -H "Accept: application/xml" $RHDG_URL/rest/v2/caches/cache-replicated-01?action=config
# Accept JSON
curl -s -k -u admin:password -H "Accept: application/json" $RHDG_URL/rest/v2/caches/cache-replicated-01?action=config</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if the cache is not present in the cluster, you can use the convert action of the caches endpoint:</p>
</div>
<div class="listingblock console-input">
<div class="title">Conver from XML to YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl $RHDG_URL/rest/v2/caches?action=convert \
  --digest -u admin:password \
  -X POST -k \
  -H "Accept: application/yaml" \
  -H "Content-Type: application/xml" \
  -d '&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;replicated-cache mode="SYNC" statistics="false"&gt;&lt;encoding media-type="application/x-protostream"/&gt;&lt;expiration lifespan="300000" /&gt;&lt;memory max-size="400MB" when-full="REMOVE"/&gt;&lt;state-transfer enabled="true" await-initial-transfer="false"/&gt;&lt;/replicated-cache&gt;'</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This endpoint also validates the cache configuration and migrates from deprecated parameters to up-to-date ones!!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_useful_kcs"><a class="anchor" href="#_useful_kcs"></a>Useful KCS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Do you have other needs and you would like to have the <code>jcmd</code> command inside the pod? Try the documentation of this KCS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KCS: <a href="https://access.redhat.com/solutions/6964022">Alternatives for creating heap dump and thread dump in a DG 8 even without the JDK</a>.</p>
</li>
<li>
<p>KCS: <a href="https://access.redhat.com/solutions/6968671">Troubleshoot options for Data Grid pod crash</a>.</p>
</li>
<li>
<p>KCS: <a href="https://access.redhat.com/solutions/6962483">Using inspect for DG 8 troubleshooting</a>.</p>
</li>
<li>
<p>KCS: <a href="https://access.redhat.com/solutions/6452611">DG 8 Troubleshooting steps for issues in OCP 4</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="40-cache-configuration.html">4. Cache Configuration</a></span>
  <span class="next"><a href="60-exercises.html">6. Exercises</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
